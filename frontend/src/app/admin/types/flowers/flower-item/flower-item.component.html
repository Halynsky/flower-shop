<div class="panel-header item ui-grid-col-6">
  <button pButton icon="fa fa-arrow-left" class="button-back" label="Назад" routerLink="../../"></button>
  <h1>{{mode == ItemSaveMode.new ? 'Додати' : 'Оновити'}} <b>Квітку</b></h1>
</div>

<div class="panel-content">

  <form #form="ngForm" class="item-form" (ngSubmit)="form.valid && onSubmit()">

    <div class="ui-grid ui-grid-responsive ui-fluid">

      <div class="prime-form-group">
        <div class="ui-grid-col-3">
          <label for="name">Назва</label>
        </div>
        <div class="ui-grid-col-3">
          <input
            pInputText
            #name="ngModel"
            id="name"
            name="name"
            [(ngModel)]="item.name"
            [uniqueValidator]="dataService.isNameFree.bind(dataService)"
            [previousValue]="previousName"
          />
        </div>
        <div class="ui-grid-col-3" *ngIf="name.errors?.unique">
          <ng-container>
            <p-message severity="error" text="Дана квітка вже існує"></p-message>
          </ng-container>
        </div>
      </div>

      <div class="prime-form-group">
        <div class="ui-grid-col-3">
          <label for="nameOriginal">Назва(англ)</label>
        </div>
        <div class="ui-grid-col-3">
          <input
            pInputText
            #nameOriginal="ngModel"
            id="nameOriginal"
            name="nameOriginal"
            [(ngModel)]="item.nameOriginal"
            [uniqueValidator]="dataService.isNameOriginalFree.bind(dataService)"
            [previousValue]="previousNameOriginal"
          />
        </div>
        <div class="ui-grid-col-3" *ngIf="nameOriginal.errors?.unique">
          <ng-container>
            <p-message severity="error" text="Дана квітка вже існує"></p-message>
          </ng-container>
        </div>
      </div>

      <div class="prime-form-group">
        <div class="ui-grid-col-3">
          <label for="image">Картинка</label>
        </div>
        <div class="ui-grid-col-3">
          <image-preview [previewSize]="80" (fileChange)="addImage($event)" class="image" id="image"
                         [image]="item.image"></image-preview>
        </div>
        <div class="ui-grid-col-3">
        </div>
      </div>

      <div class="prime-form-group">
        <div class="ui-grid-col-3">
          <label for="flowerType">Тип квітки</label>
        </div>
        <div class="ui-grid-col-3">
          <div class="dropdown-block">
            <p-dropdown [options]="flowerTypes" name="flowerType" optionLabel="name" dataKey="id" [(ngModel)]="item.flowerType"
                        placeholder="Оберіть тип квітки" id="flowerType"></p-dropdown>
          </div>
        </div>
      </div>

      <div class="prime-form-group">
        <div class="ui-grid-col-3">
          <label for="groupName">Група</label>
        </div>
        <div class="ui-grid-col-3">
          <input
            pInputText
            #groupName="ngModel"
            id="groupName"
            name="groupName"
            [(ngModel)]="item.groupName"/>
        </div>
      </div>

      <div class="prime-form-group">
        <div class="ui-grid-col-3">
          <label for="flowerSizeMin">Розмір(cm)</label>
        </div>
        <div class="ui-grid-col-3">
          <input
            pInputText
            #flowerSizeMin="ngModel"
            id="flowerSizeMin"
            name="flowerSizeMin"
            [(ngModel)]="item.flowerSizeMin"
            rangePair
            [rangePairMax]="item.flowerSizeMax"
            [rangePair]="'flowerSizeMax'"
          /> — <input
          pInputText
          #flowerSizeMax="ngModel"
          id="flowerSizeMax"
          name="flowerSizeMax"
          [(ngModel)]="item.flowerSizeMax"
          rangePair
          required
          [rangePairMin]="item.flowerSizeMin"
        />
        </div>
        <div class="ui-grid-col-3">
          <div *ngIf="flowerSizeMax.errors?.required">
            <ng-container *ngIf="flowerSizeMax.dirty || flowerSizeMax.touched || form.submitted">
              <p-message *ngIf="flowerSizeMax.errors?.required" severity="error" text="Повинно бути вказано"></p-message>
            </ng-container>
          </div>
          <ng-container *ngIf="flowerSizeMax.errors?.rangePair">
            <p-message  severity="error" text="Максимальне значення повинне бути більше ніж мінімальне"></p-message>
          </ng-container>
        </div>
      </div>

      <div class="prime-form-group">
        <div class="ui-grid-col-3">
          <label for="flowerHeightMin">Висота(cm)</label>
        </div>
        <div class="ui-grid-col-3">
          <input
            pInputText
            #flowerHeightMin="ngModel"
            id="flowerHeightMin"
            name="flowerHeightMin"
            [(ngModel)]="item.flowerHeightMin"
            rangePair
            [rangePairMax]="item.flowerHeightMax"
            [rangePair]="'flowerHeightMax'"
          /> — <input
          pInputText
          #flowerHeightMax="ngModel"
          id="flowerHeightMax"
          name="flowerHeightMax"
          [(ngModel)]="item.flowerHeightMax"
          rangePair
          required
          [rangePairMin]="item.flowerHeightMin"
        />
        </div>
        <div class="ui-grid-col-3">
          <div *ngIf="flowerHeightMax.errors?.required">
            <ng-container *ngIf="flowerHeightMax.dirty || flowerHeightMax.touched || form.submitted">
              <p-message *ngIf="flowerHeightMax.errors?.required" severity="error" text="Повинно бути вказано"></p-message>
            </ng-container>
          </div>
          <ng-container *ngIf="flowerHeightMax.errors?.rangePair">
            <p-message  severity="error" text="Максимальне значення повинне бути більше ніж мінімальне"></p-message>
          </ng-container>
        </div>
      </div>

      <div class="prime-form-group">
        <div class="ui-grid-col-3">
          <label for="popularity">Рейтинг</label>
        </div>
        <p-rating
          #popularity="ngModel"
          id="popularity"
          name="popularity"
          [(ngModel)]="item.popularity" stars="10"></p-rating>
      </div>


      <div class="prime-form-group">
        <div class="ui-grid-col-3">
          <label for="isNew">Новинка</label>
        </div>
        <div class="ui-grid-col-3">
          <p-inputSwitch
            #isNew="ngModel"
            id="isNew"
            name="isNew"
            [(ngModel)]="item.isNew"></p-inputSwitch>
        </div>
      </div>

      <div class="prime-form-group">
        <div class="ui-grid-col-3">
          <label for="isPopular">Популярна</label>
        </div>
        <div class="ui-grid-col-3">
          <p-inputSwitch
            #isPopular="ngModel"
            id="isPopular"
            name="isPopular"
            [(ngModel)]="item.isPopular"></p-inputSwitch>
        </div>
      </div>

      <div class="prime-form-group">
        <div class="ui-grid-col-3">
          <label for="color">Колір</label>
        </div>
        <div class="ui-grid-col-3">
          <div class="dropdown-block color-dropdown-block">
            <p-dropdown [options]="colors" id="color" name="color" [(ngModel)]="item.color" placeholder="Оберіть колір квітки"
                        optionLabel="name" dataKey="id"></p-dropdown>
            <div *ngIf="item.color" class="chosen-item">
              <div class="color-square" [ngStyle]="{'background-color': item.color.hex}"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="prime-form-group" style="align-items: flex-start;">
        <div class="ui-grid-col-3" style="margin-top: 7px;">
          <label for="size">Розмір та ціна(коп.)</label>
        </div>

        <div class="ui-grid-col-3">

          <div class="size-wrapper ">
            <p-multiSelect id="size" [options]="sizes" [(ngModel)]="sizesToChange" name="flowerSizesToChange"
                           (onClick)="isEditFlowerSizesShowed=true" (onChange)="initializeFlowerSizes()" optionLabel="name"
                           defaultLabel="Оберіть розміри квітки"></p-multiSelect>
            <div *ngIf="isEditFlowerSizesShowed">
              <div class="size-price-block" *ngFor="let sizeToChange of sizesToChange; let i = index">
                <div class="size-block">{{sizeToChange.name}}</div>
                —
                <div class="price-block"><input name="priceToChange" [(ngModel)]="flowerSizes[i].price"
                                                (ngModelChange)="onSizeChange(sizeToChange, i)" style="width: 60px"></div>
              </div>
            </div>
            <div *ngIf="!isEditFlowerSizesShowed">
              <div class="size-price-block" *ngFor="let sizeToChange of this.item.flowerSizes; let i = index">
                <div class="size-block">{{sizeToChange.size.name}}</div>
                —
                <div class="price-block"><input name="sizesToChange" [(ngModel)]="this.item.flowerSizes[i].price" style="width: 60px"></div>
              </div>
            </div>

          </div>

        </div>
      </div>

    </div>

    <div class="ui-grid-row ui-grid-field">
      <div class="ui-grid-col-6 footer">
        <button type="submit" pButton icon="pi pi-check" class="ui-button-success" label="{{mode == ItemSaveMode.new ? 'Зберегти' : 'Оновити'}}"></button>
      </div>
    </div>

  </form>

</div>

